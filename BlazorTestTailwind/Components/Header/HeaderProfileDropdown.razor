<div class="relative isolate" @onclick:stopPropagation>
    <button @onclick="ToggleProfile" class="flex cursor-pointer items-center gap-3 rounded-xl p-2 transition-all duration-300 hover:bg-white/20 focus:outline-none" aria-haspopup="menu" aria-expanded="@showProfile">
        <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-yellow-400 to-orange-500 shadow-lg">
            <span class="text-sm font-bold text-white">JD</span>
        </div>
        <div class="hidden md:block ltr:text-left rtl:text-right">
            <p class="text-sm font-medium text-white">John Doe</p>
            <p class="text-xs text-white/70">Administrator</p>
        </div>
        <svg class="h-4 w-4 transform text-white/70 @(showProfile ? "rotate-180" : "") transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
    </button>

    @if (showProfile)
    {
        <div class="absolute top-full z-50 mt-2 max-h-[min(80vh,28rem)] w-64 overflow-auto rounded-2xl border border-gray-200 bg-white shadow-2xl transition-all duration-200 ease-out ltr:right-0 rtl:left-0 @(isClosing ? "opacity-0 -translate-y-2" : "opacity-100 translate-y-0") dark:border-gray-700 dark:bg-gray-800">
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 dark:from-gray-700 dark:to-gray-800">
                <div class="flex items-center gap-3">
                    <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-yellow-400 to-orange-500">
                        <span class="font-bold text-white">JD</span>
                    </div>
                    <div class="ltr:text-left rtl:text-right">
                        <p class="font-semibold text-gray-900 dark:text-white">John Doe</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">john@globalapp.com</p>
                    </div>
                </div>
            </div>
            <div class="py-2">
                <a @onclick="NavigateToProfile" class="flex cursor-pointer items-center px-4 py-3 text-sm text-gray-700 transition-colors hover:bg-blue-50 dark:text-gray-300 dark:hover:bg-gray-700">
                    <svg class="h-5 w-5 text-blue-500 ltr:mr-3 rtl:ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    My Profile
                </a>
                <a @onclick="NavigateToSettings" class="flex cursor-pointer items-center px-4 py-3 text-sm text-gray-700 transition-colors hover:bg-blue-50 dark:text-gray-300 dark:hover:bg-gray-700">
                    <svg class="h-5 w-5 text-green-500 ltr:mr-3 rtl:ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Settings
                </a>
                <hr class="my-2 border-gray-200 dark:border-gray-700">
                <a href="#" @onclick="CloseProfileAnimated" class="flex cursor-pointer items-center px-4 py-3 text-sm text-red-600 transition-colors hover:bg-red-50 dark:hover:bg-red-900/20">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    Sign Out
                </a>
            </div>
        </div>
    }
</div>

    @inject NavigationManager NavigationManager

@code {
    private bool showProfile = false;

    private void ToggleProfile()
    {
        showProfile = !showProfile;
    }

    private bool isClosing = false;

    public async Task CloseProfileAnimated()
    {
        if (!showProfile || isClosing)
            return;

        isClosing = true;
        StateHasChanged();
        try
        {
            await Task.Delay(200);
        }
        catch { }
        showProfile = false;
        isClosing = false;
        StateHasChanged();
    }

    public void CloseProfile()
    {
        if (showProfile)
        {
            showProfile = false;
            isClosing = false;
            StateHasChanged();
        }
    }

    private void NavigateToProfile()
    {
        NavigationManager.NavigateTo("/profile");
        CloseProfile();
    }

    private void NavigateToSettings()
    {
        NavigationManager.NavigateTo("/settings");
        CloseProfile();
    }
}